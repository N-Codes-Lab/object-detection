var I=Object.defineProperty,z=Object.defineProperties;var E=Object.getOwnPropertyDescriptors;var O=Object.getOwnPropertySymbols;var T=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var w=(e,t,o)=>t in e?I(e,t,{enumerable:!0,configurable:!0,writable:!0,value:o}):e[t]=o,S=(e,t)=>{for(var o in t||(t={}))T.call(t,o)&&w(e,o,t[o]);if(O)for(var o of O(t))$.call(t,o)&&w(e,o,t[o]);return e},B=(e,t)=>z(e,E(t));var k=(e,t,o)=>(w(e,typeof t!="symbol"?t+"":t,o),o);import{j as R,r as y,l as C,o as U,d as j,e as F,t as Y,i as q,f as H,R as X,a as G}from"./vendor.9f3aca06.js";const K=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const n of r)if(n.type==="childList")for(const f of n.addedNodes)f.tagName==="LINK"&&f.rel==="modulepreload"&&i(f)}).observe(document,{childList:!0,subtree:!0});function o(r){const n={};return r.integrity&&(n.integrity=r.integrity),r.referrerpolicy&&(n.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?n.credentials="include":r.crossorigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function i(r){if(r.ep)return;r.ep=!0;const n=o(r);fetch(r.href,n)}};K();const h=R.exports.jsx,v=R.exports.jsxs,J=e=>v("div",B(S({className:"wrapper"},e),{children:[h("div",{className:"spinner"}),h("p",{children:e.children})]}));class Q{constructor(){k(this,"open",(t,o)=>{navigator.mediaDevices&&navigator.mediaDevices.getUserMedia?navigator.mediaDevices.getUserMedia({audio:!1,video:{facingMode:"environment"}}).then(i=>{window.localStream=i,t.current.srcObject=i,t.current.onloadedmetadata=()=>{o()}}):alert("Can't open Webcam!")});k(this,"close",t=>{t.current.srcObject?(t.current.srcObject=null,window.localStream.getTracks().forEach(o=>{o.stop()})):alert("Please open Webcam first!")})}}var V=["person","bicycle","car","motorcycle","airplane","bus","train","truck","boat","traffic light","fire hydrant","stop sign","parking meter","bench","bird","cat","dog","horse","sheep","cow","elephant","bear","zebra","giraffe","backpack","umbrella","handbag","tie","suitcase","frisbee","skis","snowboard","sports ball","kite","baseball bat","baseball glove","skateboard","surfboard","tennis racket","bottle","wine glass","cup","fork","knife","spoon","bowl","banana","apple","sandwich","orange","broccoli","carrot","hot dog","pizza","donut","cake","chair","couch","potted plant","bed","dining table","toilet","tv","laptop","mouse","remote","keyboard","cell phone","microwave","oven","toaster","sink","refrigerator","book","clock","vase","scissors","teddy bear","hair drier","toothbrush"];function Z(e){var t=[];return t[0]=e[0]-e[2]/2,t[1]=e[1]-e[3]/2,t[2]=e[0]+e[2]/2,t[3]=e[1]+e[3]/2,t}const ee=(e,t,o,i,r)=>{const n=e.current.getContext("2d");n.clearRect(0,0,n.canvas.width,n.canvas.height);const f="18px sans-serif";n.font=f,n.textBaseline="top";for(let a=0;a<i.length;++a)if(i[a]>t){const u=V[r[a]],p=(i[a]*100).toFixed(1);let[s,d,c,l]=Z(o[a]);const m=c-s,g=l-d;n.strokeStyle="#B033FF",n.lineWidth=2,n.strokeRect(s,d,m,g),n.fillStyle="#B033FF";const x=n.measureText(u+" - "+p+"%").width,b=parseInt(f,10);n.fillRect(s-1,d-(b+2),x+2,b+2),n.fillStyle="#ffffff",n.fillText(u+" - "+p+"%",s-1,d-(b+2))}};function L(e){var t=[];return t[0]=e[0]-e[2]/2,t[1]=e[1]-e[3]/2,t[2]=e[0]+e[2]/2,t[3]=e[1]+e[3]/2,t}function te(e,t=.5,o=.2,i=300){const r=[];for(let a=0;a<e.length;a++){if(e[a][4]<t)continue;var n=e[a].slice(0,4),f=e[a].slice(5).reduce((c,l,m,g)=>l>g[c]?m:c,0);const p=e[a][f+5];let s=L(n),d=!0;for(let c=0;c<r.length;c++){let l=L(r[c]),m=Math.max(s[0],l[0]),g=Math.max(s[1],l[1]),x=Math.min(s[2],l[2]),b=Math.min(s[3],l[3]),N=Math.max(0,x-m),_=Math.max(0,b-g),A=N*_,D=(s[2]-s[0])*(s[3]-s[1]),P=(l[2]-l[0])*(l[3]-l[1]),W=D+P-A;if(A/W>=o){d=!1;break}}if(d){const c=n.concat(p,f);r.push(c)}}return r}function M(e,t){return e.map(function(o){return t.map(function(i){return o[i]})})}const ne=()=>{const[e,t]=y.exports.useState({loading:!0,progress:0}),o=y.exports.useRef(null),i=y.exports.useRef(null),r=new Q,n="yolov7",f=.8,a=async u=>{const p=[640,640];F().startScope();const s=Y(()=>q.resizeBilinear(H(o.current),p).div(255).transpose([2,0,1]).expandDims(0));await u.executeAsync(s).then(d=>{d=d.arraySync()[0];var c=te(d);const l=M(c,[0,1,2,3]),m=M(c,[4]),g=M(c,[5]);ee(i,f,l,m,g),j(d)}),requestAnimationFrame(()=>a(u)),F().endScope()};return y.exports.useEffect(()=>{C(`${window.location.origin}/${n}_web_model/model.json`,{onProgress:u=>{t({loading:!0,progress:u})}}).then(async u=>{const p=U(u.inputs[0].shape);await u.executeAsync(p).then(s=>{j(s),j(p),t({loading:!1,progress:1}),r.open(o,()=>a(u))})})},[]),console.warn=()=>{},v("div",{className:"App",children:[h("h2",{children:"Object Detection Using YOLOv7 & Tensorflow.js"}),e.loading?v(J,{children:["Loading model... ",(e.progress*100).toFixed(2),"%"]}):h("p",{children:" "}),v("div",{className:"content",children:[h("video",{autoPlay:!0,playsInline:!0,muted:!0,ref:o,id:"frame"}),h("canvas",{width:640,height:640,ref:i})]})]})};X.render(h(G.StrictMode,{children:h(ne,{})}),document.getElementById("root"));
